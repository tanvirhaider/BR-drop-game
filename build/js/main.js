var stopID,start,progress,testBucket=document.getElementById("bucket"),boxQueue=[],currentIndex,currentBox,scoreCount=0,numberOfItem=10,speed=8,acceptableCount=5,endTimer=10,timeOutScreen=document.getElementById("time-out"),completedScreen=document.getElementById("completed"),device="mobile",Stopwatch=function(e,t){var n=u(),o,r,i;function u(){return document.createElement("span")}function c(){i||(o=Date.now(),i=setInterval(a,t.delay))}function s(){i&&(clearInterval(i),i=null)}function l(){r=0,d()}function a(){r+=m(),d()}function d(){var e=Math.round(r/1e3);(n.innerHTML=e)==endTimer&&(window.cancelAnimationFrame(stopID),console.log("game timed out"),timeOutScreen.style.display="block",s())}function m(){var e=Date.now(),t=e-o;return o=e,t}(t=t||{}).delay=t.delay||1,e.appendChild(n),l(),this.start=c,this.stop=s,this.reset=l},timerDisplayBox=document.getElementById("timerDisplayBox"),StopWatch=new Stopwatch(timerDisplayBox),startGame=function(){var e=Math.floor(10*Math.random()+1),t=document.getElementById("box-"+e),n=document.getElementById("wrapper").offsetWidth,o=document.getElementById("wrapper").offsetHeight,r=document.getElementById("scoreBox"),i;function u(){for(var e=1;e<=numberOfItem;e++){var t=document.getElementById("box-"+e);boxQueue.push(t),t.style.top="-150px",t.style.display="block"}}function c(){timeOutScreen.style.display="none",completedScreen.style.display="none",StopWatch.reset(),StopWatch.start(),currentBox=boxQueue[currentIndex=scoreCount=0],r.innerHTML="SCORE: "+scoreCount,u(),window.requestAnimationFrame(s)}function s(e){(!start||o-150<progress)&&(console.log("------------  progress complete"),start=e),progress=(e-start)/(11-speed)+50,currentBox.style.top=progress+"px",stopID=window.requestAnimationFrame(s);var t=HitTest(testBucket,currentBox);console.log("collide value: ",t),t&&(scoreCount++,r.innerHTML="SCORE: "+scoreCount,start=e,currentBox.style.display="none",++currentIndex==numberOfItem&&(window.cancelAnimationFrame(stopID),StopWatch.stop(),completedScreen.style.display="block"),currentBox=boxQueue[currentIndex])}document.getElementById("restart").addEventListener("click",function(){console.log("restart has been pressed"),window.cancelAnimationFrame(stopID),c()}),c(),currentBox=boxQueue[currentIndex],this.resetPosition=u};function DragElementDesktop(t){var n=0,o=0,r=0,i=0;function e(e){(e=e||window.event).preventDefault(),r=e.clientX,i=e.clientY,document.onmouseup=c,document.ontouchend=c,document.onmousemove=u,document.ontouchmove=u}function u(e){(e=e||window.event).preventDefault(),n=r-e.clientX,o=i-e.clientY,r=e.clientX,i=e.clientY,t.style.top=t.offsetTop-o+"px",t.style.left=t.offsetLeft-n+"px"}function c(){document.onmouseup=null,document.onmousemove=null,document.ontouchend=null,document.ontouchmove=null}t.onmousedown=e,t.ontouchstart=e}function HitTest(e,t){var n=e.getBoundingClientRect(),o=t.getBoundingClientRect(),r=!1;return r=n.left<o.left+o.width&&n.left+n.width>o.left&&n.top<o.top+o.height&&n.top+n.height>o.top}function DragElementMobile(e,n){var o=null,r=0,i=0;function t(e){e.preventDefault(),e.stopPropagation(),(o=n).style.position="absolute";var t=o.getBoundingClientRect();"mousedown"==e.type?(r=e.clientX-t.left,i=e.clientY-t.top,window.addEventListener("mousemove",u,!0)):"touchstart"==e.type&&(r=e.targetTouches[0].clientX-t.left,i=e.targetTouches[0].clientY-t.top,window.addEventListener("touchmove",u,!0))}function u(e){e.preventDefault(),e.stopPropagation(),null!=o&&("mousemove"==e.type?(o.style.left=e.clientX-r+"px",o.style.top=e.clientY-i+"px"):"touchmove"==e.type&&(o.style.left=e.targetTouches[0].clientX-r+"px",o.style.top=e.targetTouches[0].clientY-i+"px"))}e.addEventListener("mousedown",t,!0),e.addEventListener("touchstart",t,!0),document.onmouseup=function(e){o&&(o=null,window.removeEventListener("mousemove",u,!0),window.removeEventListener("touchmove",u,!0))}}var isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)||navigator.userAgent.match(/WPDesktop/i)},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows()}};isMobile.any()?DragElementMobile(testBucket,testBucket):DragElementDesktop(testBucket),startGame();